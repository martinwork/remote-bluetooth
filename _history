{"entries":[{"timestamp":1766099103787,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":185,"diffs":[[1,"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":33,"diffs":[[1,"\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":98,"length1":52,"diffs":[[1,"        \"radio\": \"*\",\n        \"microphone\": \"*\"\n"]]},{"start1":210,"length1":41,"diffs":[[1,"        \"README.md\"\n"]]},{"start1":237,"length1":31,"diffs":[[1,"    \"additionalFilePaths\": []\n"]]}]},{"type":"added","filename":"custom.ts","value":"\n/**\n* Use this file to define custom functions and blocks.\n* Read more at https://makecode.microbit.org/blocks/custom\n*/\n\nenum MyEnum {\n    //% block=\"one\"\n    One,\n    //% block=\"two\"\n    Two\n}\n\n/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class State {\n        running : boolean = false\n        last_command : string = \"\"\n\n        constructor() {\n\n        }\n    }\n    let state : State = undefined\n\n    function initialise(): void {\n        if ( state == undefined) {\n            state = new State\n            bluetooth.onBluetoothConnected( function () {\n\n            })\n        }\n    }\n    \n    /**\n     * TODO: describe your function here\n     * @param value describe value here, eg: 5\n     */\n    //% block\n    export function fib(value: number): number {\n        return value <= 1 ? value : fib(value -1) + fib(value - 2);\n    }\n}\n"}]},{"timestamp":1766099612609,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":331,"length1":121,"diffs":[[1,"        last_command : string = \"\"\n\n"]]},{"start1":443,"length1":90,"diffs":[[1,""]]},{"start1":542,"length1":99,"diffs":[[1,"            bluetooth.onBluetoothConnected( function () {\n\n"]]},{"start1":616,"length1":599,"diffs":[[1,""]]},{"start1":755,"length1":120,"diffs":[[1,"    export function fib(value: number): number {\n        return value <= 1 ? value : fib(value -1) + fib(value - 2);\n"]]}]}]},{"timestamp":1766100202783,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":331,"length1":42,"diffs":[[1,"        lastCommand : string = \"\"\n"]]},{"start1":414,"length1":77,"diffs":[[1,"        bleConnected: boolean = false\n"]]},{"start1":476,"length1":0,"diffs":[[1,"\n"]]},{"start1":493,"length1":1,"diffs":[[1,""]]},{"start1":527,"length1":0,"diffs":[[1,"\n    function onDataReceived(command: string) {\n        state.lastCommand = command\n    }\n\n"]]},{"start1":652,"length1":34,"diffs":[[1,"        if ( state == undefined) {\n"]]},{"start1":717,"length1":0,"diffs":[[1,"            bluetooth.onBluetoothConnected(function () {\n                state.bleConnected = true\n            })\n            bluetooth.onBluetoothDisconnected(function () {\n                state.bleConnected = true\n            })\n"]]},{"start1":1042,"length1":41,"diffs":[[1,"                state.bleConnected = true\n"]]},{"start1":1281,"length1":45,"diffs":[[1,"                state.serialConnected = true;\n"]]},{"start1":1430,"length1":385,"diffs":[[1,""]]},{"start1":1446,"length1":445,"diffs":[[1,""]]}]}]},{"timestamp":1766100795856,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":297,"length1":49,"diffs":[[1,"        running : boolean = false\n"]]},{"start1":373,"length1":29,"diffs":[[1,"        commandsHandler: () => void = () => { };\n"]]},{"start1":1192,"length1":250,"diffs":[[1,"                while (Object.keys(latestCommands).length) {\n                    commandName = Object.keys(latestCommands)[0]\n                    commandValue = latestCommands[commandName]\n                    delete latestCommands[commandName];\n\n                    setup()\n                    commandsHandler()\n"]]},{"start1":1601,"length1":46,"diffs":[[1,"        state.lastCommand = command\n"]]},{"start1":1693,"length1":39,"diffs":[[1,"     * @param value describe value here, eg: 5\n"]]},{"start1":1998,"length1":1,"diffs":[[1,"    \n"]]},{"start1":2052,"length1":169,"diffs":[[1,""]]}]}]},{"timestamp":1766101386409,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":898,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"20\" y=\"20\"></block><block type=\"device_forever\" x=\"225\" y=\"20\"></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":273,"diffs":[[1,""]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":262,"length1":35,"diffs":[[1,"    \"preferredEditor\": \"tsprj\"\n"]]}]},{"type":"edited","filename":"custom.ts","patch":[{"start1":0,"length1":0,"diffs":[[1,"\n"]]},{"start1":5,"length1":0,"diffs":[[1,"* Use this file to define custom functions and blocks.\n* Read more at https://makecode.microbit.org/blocks/custom\n*/\n\nenum MyEnum {\n    //% block=\"one\"\n    One,\n    //% block=\"two\"\n    Two\n}\n\n/**\n"]]},{"start1":569,"length1":5,"diffs":[[1,""]]},{"start1":1470,"length1":41,"diffs":[[1,""]]},{"start1":2152,"length1":42,"diffs":[[1,"     * @param value describe value here, eg: 5\n"]]}]}]},{"timestamp":1766101758660,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":899,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field></block></statement></block><block type=\"device_forever\" x=\"260\" y=\"4\"></block><block type=\"bluetooth_on_connected\" x=\"485\" y=\"-6\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"483\" y=\"153\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"custom_onCommand\" x=\"8\" y=\"178\"><statement name=\"HANDLER\"><block type=\"custom_sendData\"><value name=\"data\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"custom_command\"></block></value></block></statement></block></xml>"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":262,"length1":31,"diffs":[[1,"    \"preferredEditor\": \"blocksprj\"\n"]]}]},{"type":"edited","filename":"custom.ts","patch":[{"start1":445,"length1":37,"diffs":[[1,""]]}]}]},{"timestamp":1766102329425,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":844,"length1":43,"diffs":[[1,""]]},{"start1":1282,"length1":35,"diffs":[[1,""]]},{"start1":1420,"length1":72,"diffs":[[1,""]]}]}]},{"timestamp":1766102846554,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":932,"length1":17,"diffs":[[1,""]]}]}]},{"timestamp":1766146091035,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":932,"length1":21,"diffs":[[1,"                \n"]]}]}]},{"timestamp":1766146092700,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1429,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field></block></statement></block><block type=\"device_forever\" x=\"260\" y=\"4\"></block><block type=\"bluetooth_on_connected\" x=\"485\" y=\"-6\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"custom_onCommand\" x=\"-1\" y=\"166\"><statement name=\"HANDLER\"><block type=\"custom_sendData\"><value name=\"data\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"custom_command\"></block></value></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"483\" y=\"153\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":273,"length1":86,"diffs":[[1,""]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":262,"length1":35,"diffs":[[1,"    \"preferredEditor\": \"tsprj\"\n"]]}]},{"type":"edited","filename":"custom.ts","patch":[{"start1":647,"length1":121,"diffs":[[1,"                onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n"]]},{"start1":932,"length1":169,"diffs":[[1,"                let \n                onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n"]]}]}]},{"timestamp":1766146689715,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1428,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"23\" y=\"2\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"serialWriteNewLinePadding\"><value name=\"length\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"128\" label=\"Length\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow></value><next><block type=\"serialSetTxBufferSize\"><value name=\"size\"><shadow type=\"math_number\"><field name=\"NUM\">254</field></shadow></value><next><block type=\"serialSetRxBufferSize\"><value name=\"size\"><shadow type=\"math_number\"><field name=\"NUM\">254</field></shadow></value></block></next></block></next></block></next></block></statement></block><block type=\"device_forever\" x=\"260\" y=\"4\"></block><block type=\"bluetooth_on_connected\" x=\"485\" y=\"-6\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"483\" y=\"153\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"custom_onCommand\" x=\"28\" y=\"306\"><statement name=\"HANDLER\"><block type=\"custom_sendData\"><value name=\"data\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"custom_command\"></block></value></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":303,"length1":56,"diffs":[[1,"serial.setTxBufferSize(254)\nserial.setRxBufferSize(254)\n"]]}]},{"type":"edited","filename":"custom.ts","patch":[{"start1":445,"length1":0,"diffs":[[1,"            serial.writeLine(\"init\")\n"]]},{"start1":647,"length1":95,"diffs":[[1,"                let c = bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine))\n                onDataReceived(c)\n"]]},{"start1":870,"length1":0,"diffs":[[1,"                serial.writeLine(\"serial\")\n"]]},{"start1":958,"length1":88,"diffs":[[1,"                let c = serial.readUntil(serial.delimiters(Delimiters.NewLine))\n                serial.writeLine(\"length \" + c.length)\n                onDataReceived(c)\n"]]},{"start1":1605,"length1":0,"diffs":[[1,"        serial.writeLine(\"received \")\n        serial.writeLine(command)\n"]]}]}]},{"timestamp":1766147476358,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"pxt.json","patch":[{"start1":262,"length1":31,"diffs":[[1,"    \"preferredEditor\": \"blocksprj\"\n"]]}]}]},{"timestamp":1766147503073,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":898,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"serialWriteNewLinePadding\"><value name=\"length\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"128\" label=\"Length\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow></value><next><block type=\"serialSetTxBufferSize\"><value name=\"size\"><shadow type=\"math_number\"><field name=\"NUM\">240</field></shadow></value><next><block type=\"serialSetRxBufferSize\"><value name=\"size\"><shadow type=\"math_number\"><field name=\"NUM\">240</field></shadow></value></block></next></block></next></block></next></block></statement></block><block type=\"device_forever\" x=\"259\" y=\"-1\"></block><block type=\"bluetooth_on_connected\" x=\"462\" y=\"-8\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"460\" y=\"151\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"custom_onCommand\" x=\"5\" y=\"304\"><statement name=\"HANDLER\"><block type=\"custom_sendData\"><value name=\"data\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"custom_command\"></block></value></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":273,"length1":0,"diffs":[[1,"serial.setWriteLinePadding(0)\nserial.setTxBufferSize(240)\nserial.setRxBufferSize(240)\n"]]}]},{"type":"edited","filename":"custom.ts","patch":[{"start1":475,"length1":122,"diffs":[[1,""]]}]}]},{"timestamp":1766147600011,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":597,"length1":13,"diffs":[[1,""]]}]}]},{"timestamp":1766148475906,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":597,"length1":16,"diffs":[[1,"            \n"]]}]}]},{"timestamp":1766148477529,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":597,"length1":68,"diffs":[[1,"            if \n"]]}]}]},{"timestamp":1766149070038,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":597,"length1":320,"diffs":[[1,"            if (typeof 'bluetooth.onUartDataReceived' === 'object')\n            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                state.receivedBLE = true\n                onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n"]]},{"start1":1503,"length1":18,"diffs":[[1,""]]},{"start1":1544,"length1":42,"diffs":[[1,""]]}]}]},{"timestamp":1766149667411,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"pxt.json","patch":[{"start1":235,"length1":44,"diffs":[[1,"        \"custom.ts\"\n"]]}]},{"type":"edited","filename":"custom.ts","patch":[{"start1":297,"length1":48,"diffs":[[1,""]]},{"start1":1528,"length1":45,"diffs":[[1,"            bluetooth.startUartService()\n"]]},{"start1":1610,"length1":0,"diffs":[[1,"\n"]]},{"start1":1727,"length1":304,"diffs":[[1,""]]},{"start1":1728,"length1":109,"diffs":[[1,""]]},{"start1":1937,"length1":105,"diffs":[[1,"            bluetooth.uartWriteLine(data)\n"]]}]},{"type":"added","filename":"customble.ts","value":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand = \"\"\n        receivedBLE: boolean = false\n        receivedSerial: boolean = false\n        constructor() {\n        }\n    }\n\n    let state: State = undefined\n\n    function initialise(): void {\n        if (state == undefined) {\n            state = new State\n            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            try {\n                bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                    state.receivedBLE = true\n                    onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n                })\n            } catch (e) {\n\n            }\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                state.receivedSerial = true;\n                onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                    basic.pause(0)\n                }\n            })\n            try {\n                bluetooth.startUartService()\n            } catch (e) {\n\n            }\n        }\n    }\n\n    function onDataReceived(command: string) {\n        state.receivedCommands.push(command)\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        if (state.receivedBLE) {\n            try {\n                bluetooth.uartWriteLine(data)\n            } catch (e) {\n\n            }\n        }\n        if (state.receivedBLE) {\n            serial.writeLine(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        if (state.receivedBLE) {\n            try {\n                bluetooth.uartWriteLine(data)\n            } catch (e) {\n\n            }\n        }\n        if (state.receivedBLE) {\n            serial.writeLine(data)\n        }\n    }\n}\n"}]},{"timestamp":1766150265278,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"pxt.json","patch":[{"start1":256,"length1":50,"diffs":[[1,"        \"customble.ts\"\n"]]}]},{"type":"edited","filename":"custom.ts","patch":[{"start1":82,"length1":171,"diffs":[[1,""]]},{"start1":149,"length1":40,"diffs":[[1,"        receivedCommands : string [] = []\n"]]},{"start1":220,"length1":38,"diffs":[[1,"        receivedBLE: boolean = false\n        receivedSerial: boolean = false\n        sendHandler: ((string) => void)[] = [];\n"]]},{"start1":386,"length1":1,"diffs":[[1,""]]},{"start1":1959,"length1":111,"diffs":[[1,"        if (state.receivedBLE) {\n            try {\n                bluetooth.uartWriteLine(data)\n            } catch (e) {\n\n            }\n"]]},{"start1":2107,"length1":0,"diffs":[[1,"        if (state.receivedBLE) {\n            serial.writeLine(data)\n        }\n"]]},{"start1":2241,"length1":0,"diffs":[[1,"     * @param data describe value here\n"]]},{"start1":2302,"length1":0,"diffs":[[1,"    export function sendData(data: string) {\n        initialise()\n        if (state.receivedBLE) {\n            try {\n                bluetooth.uartWriteLine(data)\n            } catch (e) {\n\n            }\n        }\n        if (state.receivedBLE) {\n            serial.writeLine(data)\n        }\n    }\n\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n"]]}]},{"type":"edited","filename":"customble.ts","patch":[{"start1":82,"length1":44,"diffs":[[1,"    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand = \"\"\n        receivedBLE: boolean = false\n        receivedSerial: boolean = false\n        constructor() {\n        }\n    }\n"]]},{"start1":336,"length1":0,"diffs":[[1,"    let state: State = undefined\n\n"]]},{"start1":468,"length1":0,"diffs":[[1,"            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n"]]}]},{"type":"added","filename":"customserial.ts","value":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class Transport {\n        active: boolean = false\n        sendHandler: (data: string) => void = (data: string) => { };\n        constructor() {\n        }\n    }\n\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand = \"\"\n        transports: Transport[] = [];\n        constructor() {\n        }\n    }\n\n\n    let state: State = undefined\n\n    function initialise(): void {\n        if (state == undefined) {\n            state = new State\n            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            try {\n                bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                    state.receivedBLE = true\n                    onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n                })\n            } catch (e) {\n\n            }\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                state.receivedSerial = true;\n                onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                    basic.pause(0)\n                }\n            })\n            try {\n                bluetooth.startUartService()\n            } catch (e) {\n\n            }\n        }\n    }\n\n    function onDataReceived(command: string) {\n        state.receivedCommands.push(command)\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        for (let index = 0; index < state.sendHandlers.length; index++) {\n            state.sendHandlers(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n"}]},{"timestamp":1766150856744,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":82,"length1":122,"diffs":[[1,"    export class Transport {\n        active: boolean = false\n        sendHandler: (data: string) => void = (data: string) => { };\n        constructor() {\n        }\n"]]},{"start1":467,"length1":0,"diffs":[[1,"\n\n"]]},{"start1":2042,"length1":116,"diffs":[[1,"        for (let index = 0; index < state.sendHandlers.length; index++) {\n            state.sendHandlers(data)\n"]]}]},{"type":"edited","filename":"customble.ts","patch":[{"start1":82,"length1":98,"diffs":[[1,"    let transportBLE: Transport = undefined\n"]]},{"start1":127,"length1":206,"diffs":[[1,""]]}]}]},{"timestamp":1766151443180,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":115,"length1":0,"diffs":[[1,"        active: boolean\n        initialise() : void\n"]]},{"start1":425,"length1":41,"diffs":[[1,"    let state : State = undefined\n"]]},{"start1":562,"length1":0,"diffs":[[1,"            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            try {\n                bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                    state.receivedBLE = true\n                    onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n                })\n            } catch (e) {\n\n            }\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                state.receivedSerial = true;\n                onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n"]]},{"start1":1597,"length1":0,"diffs":[[1,"            try {\n                bluetooth.startUartService()\n            } catch (e) {\n\n            }\n"]]},{"start1":2070,"length1":51,"diffs":[[1,"            state.transports.sendData(data)\n"]]}]},{"type":"edited","filename":"customble.ts","patch":[{"start1":82,"length1":46,"diffs":[[1,"    class transportBLE implements Transport {\n"]]},{"start1":151,"length1":0,"diffs":[[1,"        initialise(): void {\n\n        }\n"]]},{"start1":225,"length1":94,"diffs":[[1,"            bluetooth.uartWriteString(data)\n"]]},{"start1":279,"length1":249,"diffs":[[1,"        constructor() {\n            initialise();\n            state.transports.push(this);\n        }\n    }\n\n    function initialise(): void {\n        if (state == undefined) {\n            state = new State\n            try {\n                bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                    state.receivedBLE = true\n                    onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n                })\n            } catch (e) {\n\n            }\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                state.receivedSerial = true;\n                onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n"]]},{"start1":1040,"length1":41,"diffs":[[1,"            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                    basic.pause(0)\n                }\n            })\n            try {\n                bluetooth.startUartService()\n            } catch (e) {\n\n            }\n"]]},{"start1":1512,"length1":105,"diffs":[[1,"    }\n\n    function onDataReceived(command: string) {\n        state.receivedCommands.push(command)\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        if (state.receivedBLE) {\n            try {\n                bluetooth.uartWriteLine(data)\n            } catch (e) {\n\n            }\n"]]},{"start1":1942,"length1":0,"diffs":[[1,"        if (state.receivedBLE) {\n            serial.writeLine(data)\n        }\n"]]},{"start1":2026,"length1":48,"diffs":[[1,"\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        if (state.receivedBLE) {\n            try {\n                bluetooth.uartWriteLine(data)\n            } catch (e) {\n\n            }\n        }\n        if (state.receivedBLE) {\n            serial.writeLine(data)\n        }\n    }\n"]]}]}]},{"timestamp":1766152035712,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":115,"length1":39,"diffs":[[1,"        sendData(data: string): void\n"]]}]},{"type":"edited","filename":"customble.ts","patch":[{"start1":151,"length1":36,"diffs":[[1,"        sendData( data: string) {\n"]]}]}]},{"timestamp":1766152075190,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"customserial.ts","patch":[{"start1":82,"length1":197,"diffs":[[1,"    class Transport {\n        active: boolean = false\n        sendHandler: (data: string) => void = (data: string) => { };\n        constructor() {\n"]]},{"start1":239,"length1":315,"diffs":[[1,"    }\n\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand = \"\"\n        transports: Transport[] = [];\n"]]},{"start1":444,"length1":81,"diffs":[[1,""]]},{"start1":460,"length1":43,"diffs":[[1,""]]},{"start1":462,"length1":1,"diffs":[[1,""]]}]}]},{"timestamp":1766157682645,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"customserial.ts","patch":[{"start1":82,"length1":49,"diffs":[[1,"    class TransportBLE implements Transport {\n"]]}]}]},{"timestamp":1766157688483,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":200,"length1":40,"diffs":[[1,"    custom.sendData(custom.command())\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":280,"length1":51,"diffs":[[1,"        \"customserial.ts\"\n"]]}]},{"type":"edited","filename":"custom.ts","patch":[{"start1":421,"length1":112,"diffs":[[1,"    function initialise(): void {\n"]]},{"start1":894,"length1":125,"diffs":[[1,"    function onDataReceived(command: string) {\n"]]},{"start1":1108,"length1":47,"diffs":[[1,"    export function sendData(data: string) {\n"]]},{"start1":1246,"length1":53,"diffs":[[1,"            state.transports[index].sendData(data)\n"]]},{"start1":1482,"length1":0,"diffs":[[1,"\n"]]}]},{"type":"edited","filename":"customble.ts","patch":[{"start1":727,"length1":394,"diffs":[[1,"    transportBLE: TransportBLE = undefined\n    \n"]]}]},{"type":"edited","filename":"customserial.ts","patch":[{"start1":220,"length1":39,"diffs":[[1,"                bluetooth.uartWriteString(data)\n"]]},{"start1":310,"length1":0,"diffs":[[1,"            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                this.active = true\n                custom.onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            bluetooth.startUartService()\n        }\n        constructor() {\n            custom.initialise();\n            custom.state.transports.push(this);\n        }\n    }\n    transportBLE: TransportBLE = undefined\n\n\n\n    let state: State = undefined\n\n    function initialise(): void {\n        if (state == undefined) {\n            state = new State\n"]]},{"start1":1028,"length1":0,"diffs":[[1,"            try {\n                bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                    state.receivedBLE = true\n                    onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n                })\n            } catch (e) {\n\n            }\n"]]},{"start1":1435,"length1":131,"diffs":[[1,"                state.receivedSerial = true;\n                onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n"]]},{"start1":1583,"length1":0,"diffs":[[1,"            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                    basic.pause(0)\n                }\n            })\n            try {\n                bluetooth.startUartService()\n            } catch (e) {\n\n            }\n"]]},{"start1":2055,"length1":105,"diffs":[[1,"    }\n\n    function onDataReceived(command: string) {\n        state.receivedCommands.push(command)\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        for (let index = 0; index < state.sendHandlers.length; index++) {\n            state.sendHandlers(data)\n"]]},{"start1":2464,"length1":54,"diffs":[[1,""]]},{"start1":2536,"length1":89,"diffs":[[1,"    export function command() {\n        initialise()\n        return state.receivedCommand\n"]]},{"start1":2633,"length1":0,"diffs":[[1,"\n"]]},{"start1":2683,"length1":0,"diffs":[[1,"     * @param handler describe value here\n"]]},{"start1":2747,"length1":129,"diffs":[[1,"    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n"]]}]},{"type":"added","filename":"customBase.ts","value":"// Add your code here\n"}]},{"timestamp":1766158277569,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":82,"length1":33,"diffs":[[1,"    export interface Transport {\n        sendString(data: string): void\n    }\n\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand = \"\"\n        transports: Transport[] = [];\n        constructor() {\n        }\n    }\n    export let state : State = undefined\n    \n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function initialise(): void {\n        if (state == undefined) {\n            state = new State\n            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                    basic.pause(0)\n                }\n            })\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function onDataReceived(command: string) {\n        state.receivedCommands.push( command)\n    }\n    \n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendString(data: string) {\n        initialise()\n        for (let index = 0; index < state.transports.length; index++) {\n            state.transports[index].sendString(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n"]]}]},{"type":"edited","filename":"customBase.ts","patch":[{"start1":0,"length1":2033,"diffs":[[1,"// Add your code here\n"]]}]}]},{"timestamp":1766158854648,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1198,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field></block></statement></block><block type=\"device_forever\" x=\"260\" y=\"4\"></block><block type=\"bluetooth_on_connected\" x=\"485\" y=\"-6\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"483\" y=\"153\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"custom_onCommand\" x=\"0\" y=\"207\"><statement name=\"HANDLER\"><block type=\"custom_sendData\"><value name=\"data\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"custom_command\"></block></value></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":200,"length1":50,"diffs":[[1,"    custom.sendString(custom.command())\n"]]},{"start1":275,"length1":45,"diffs":[[1,""]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":2,"length1":26,"diffs":[[1,"    \"name\": \"init-on-demand\",\n"]]},{"start1":280,"length1":26,"diffs":[[1,"        \"customserial.ts\",\n        \"customBase.ts\"\n"]]}]},{"type":"edited","filename":"custom.ts","patch":[{"start1":82,"length1":2122,"diffs":[[1,"    startBLE()\n    startSerial()\n"]]}]},{"type":"edited","filename":"customble.ts","patch":[{"start1":847,"length1":57,"diffs":[[1,"    export function transportBLE(): TransportBLE {\n"]]},{"start1":1005,"length1":45,"diffs":[[1,"    export function startBLE(): void {\n"]]}]},{"type":"removed","filename":"customBase.ts","value":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    export interface Transport {\n        sendString(data: string): void\n    }\n\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand = \"\"\n        transports: Transport[] = [];\n        constructor() {\n        }\n    }\n    export let state: State = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function startProcessing(): void {\n        initialise()\n        basic.forever(function () {\n            while (state.receivedCommands.length) {\n                state.receivedCommand = state.receivedCommands[0]\n                state.receivedCommands.removeElement(state.receivedCommand)\n                state.commandsHandler()\n                basic.pause(0)\n            }\n        })\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function initialise(): void {\n        if (state == undefined) {\n            state = new State\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function onDataReceived(command: string) {\n        initialise()\n        state.receivedCommands.push(command)\n        startProcessing()\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendString(data: string) {\n        initialise()\n        for (let index = 0; index < state.transports.length; index++) {\n            state.transports[index].sendString(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n"}]},{"timestamp":1766159453114,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1195,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"21\" y=\"14\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"custom_startSerial\"><next><block type=\"custom_startBluetooth\"></block></next></block></next></block></statement></block><block type=\"bluetooth_on_connected\" x=\"239\" y=\"13\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"494\" y=\"13\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"device_forever\" x=\"398\" y=\"189\"></block><block type=\"custom_onCommand\" x=\"21\" y=\"272\"><statement name=\"HANDLER\"><block type=\"custom_sendString\"><value name=\"data\"><block type=\"text_join\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><shadow type=\"text\"><field name=\"TEXT\">echo </field></shadow></value><value name=\"ADD1\"><shadow type=\"text\"><field name=\"TEXT\">World</field></shadow><block type=\"custom_command\"></block></value></block></value></block></statement></block></xml>"]]}]},{"type":"edited","filename":"custom.ts","patch":[{"start1":1117,"length1":17,"diffs":[[1,""]]},{"start1":1310,"length1":17,"diffs":[[1,""]]}]},{"type":"edited","filename":"customble.ts","patch":[{"start1":833,"length1":17,"diffs":[[1,"    //% block\n"]]}]},{"type":"edited","filename":"customserial.ts","patch":[{"start1":899,"length1":17,"diffs":[[1,"    //% block\n"]]}]}]},{"timestamp":1766160045553,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"customserial.ts","patch":[{"start1":690,"length1":0,"diffs":[[1,"            custom.initialise();\n            custom.state.transports.push(this);\n"]]},{"start1":1172,"length1":85,"diffs":[[1,""]]},{"start1":1205,"length1":8,"diffs":[[1,"    }}\n"]]}]}]},{"timestamp":1766160324776,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":82,"length1":34,"diffs":[[1,"    export interface Transport {\n"]]},{"start1":341,"length1":39,"diffs":[[1,"        transports: Transport[] = [];\n"]]}]}]},{"timestamp":1766166122037,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"customble.ts","patch":[{"start1":82,"length1":48,"diffs":[[1,"    class TransportBLE implements Transport {\n"]]},{"start1":727,"length1":49,"diffs":[[1,"    let _transportBLE: TransportBLE = undefined\n"]]},{"start1":850,"length1":58,"diffs":[[1,"    export function transportBluetooth(): TransportBLE {\n"]]},{"start1":1059,"length1":42,"diffs":[[1,"        _transportBLE = new TransportBLE\n"]]}]}]},{"timestamp":1766166128053,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":342,"length1":40,"diffs":[[1,"        transports: Connection[] = [];\n"]]},{"start1":415,"length1":87,"diffs":[[1,""]]}]},{"type":"edited","filename":"customble.ts","patch":[{"start1":82,"length1":51,"diffs":[[1,"    class ConnectionBLE implements Connection {\n"]]},{"start1":665,"length1":49,"diffs":[[1,"            custom.state.transports.push(this);\n"]]},{"start1":729,"length1":56,"diffs":[[1,"    let _transportBLE: ConnectionBLE = undefined\n"]]},{"start1":853,"length1":92,"diffs":[[1,"    export function transportBluetooth(): ConnectionBLE {\n        return _transportBLE\n"]]},{"start1":1063,"length1":83,"diffs":[[1,"        _transportBLE = new ConnectionBLE\n        _transportBLE.start()\n"]]}]},{"type":"edited","filename":"customserial.ts","patch":[{"start1":82,"length1":51,"diffs":[[1,"    class TransportSerial implements Transport {\n"]]},{"start1":706,"length1":53,"diffs":[[1,"    let _transportSerial: TransportSerial = undefined\n"]]},{"start1":835,"length1":88,"diffs":[[1,"    export function transportSerial(): TransportSerial {\n        return _transportSerial\n"]]},{"start1":1044,"length1":47,"diffs":[[1,"        _transportSerial = new TransportSerial\n"]]},{"start1":1120,"length1":85,"diffs":[[1,"        custom.state.transports.push(_transportSerial);\n        _transportSerial.start()\n"]]}]}]},{"timestamp":1766166719325,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":1779,"length1":127,"diffs":[[1,"        for (let index = 0; index < state.transports.length; index++) {\n            state.transports[index].sendString(data)\n"]]}]},{"type":"edited","filename":"customble.ts","patch":[{"start1":635,"length1":0,"diffs":[[1,"            custom.initialise();\n            custom.state.connections.push(this);\n"]]},{"start1":1128,"length1":122,"diffs":[[1,"        _connectBluetooth.start()\n"]]}]},{"type":"edited","filename":"customserial.ts","patch":[{"start1":836,"length1":89,"diffs":[[1,"    export function _connectSerial(): ConnectionSerial {\n        return __connectSerial\n"]]},{"start1":1044,"length1":46,"diffs":[[1,"        __connectSerial = new ConnectionSerial\n"]]},{"start1":1120,"length1":86,"diffs":[[1,"        custom.state._connects.push(__connectSerial)\n        __connectSerial.start()\n"]]}]}]},{"timestamp":1766167269462,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":638,"length1":210,"diffs":[[1,""]]},{"start1":1238,"length1":0,"diffs":[[1,"    export function initialise(): void {\n        if (state == undefined) {\n            state = new State\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n"]]}]},{"type":"edited","filename":"customserial.ts","patch":[{"start1":303,"length1":32,"diffs":[[1,""]]}]}]},{"timestamp":1766167853973,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"customble.ts","patch":[{"start1":133,"length1":74,"diffs":[[1,"        active = false\n"]]},{"start1":192,"length1":33,"diffs":[[1,"            if ( this.active) {\n"]]},{"start1":314,"length1":352,"diffs":[[1,"            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                this.active = true\n                custom.onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            bluetooth.startUartService()\n"]]},{"start1":952,"length1":286,"diffs":[[1,"    export function startBluetooth(): void {\n        _connectBluetooth = new ConnectBluetooth\n        custom.initialise();\n        custom.state.connections.push(_connectBluetooth);\n        connectBluetooth().start()\n"]]}]},{"type":"edited","filename":"customserial.ts","patch":[{"start1":133,"length1":74,"diffs":[[1,"        active = false\n"]]}]}]},{"timestamp":1766168423405,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1189,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"custom_startSerial\"><next><block type=\"custom_startBluetooth\"></block></next></block></next></block></statement></block><block type=\"bluetooth_on_connected\" x=\"218\" y=\"-1\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"473\" y=\"-1\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"device_forever\" x=\"377\" y=\"175\"></block><block type=\"custom_onCommand\" x=\"0\" y=\"258\"><statement name=\"HANDLER\"><block type=\"custom_sendString\"><value name=\"data\"><block type=\"text_join\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><shadow type=\"text\"><field name=\"TEXT\">echo </field></shadow></value><value name=\"ADD1\"><shadow type=\"text\"><field name=\"TEXT\">World</field></shadow><block type=\"custom_command\"></block></value></block></value></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":285,"length1":41,"diffs":[[1,"custom.startSerial()\ncustom.startBluetooth()\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":309,"length1":35,"diffs":[[1,"    \"preferredEditor\": \"tsprj\"\n"]]}]},{"type":"edited","filename":"customble.ts","patch":[{"start1":133,"length1":0,"diffs":[[1,"        _active = false\n        active(): boolean { return this._active }\n"]]},{"start1":243,"length1":44,"diffs":[[1,"            if ( this._active) {\n                bluetooth.uartWriteString(data)\n            }\n"]]},{"start1":348,"length1":0,"diffs":[[1,"        start() {\n            if ( !this._active) {\n                this._active = true\n                bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                    custom.onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n                })\n                bluetooth.startUartService()\n            }\n        }\n"]]},{"start1":752,"length1":331,"diffs":[[1,""]]},{"start1":882,"length1":0,"diffs":[[1,"    //% advanced\n    export function connectBluetooth(): ConnectBluetooth {\n        return _connectBluetooth\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n"]]},{"start1":1211,"length1":0,"diffs":[[1,"            custom.initialise();\n            custom.state.connections.push(_connectBluetooth);\n            connectBluetooth().start()\n"]]}]},{"type":"edited","filename":"customserial.ts","patch":[{"start1":133,"length1":0,"diffs":[[1,"        _active = false\n        active(): boolean { return this._active }\n"]]},{"start1":242,"length1":35,"diffs":[[1,"            if (this.active) {\n                serial.writeLine(data)\n            }\n"]]},{"start1":336,"length1":102,"diffs":[[1,"        start() {\n            this.active = true;\n"]]},{"start1":741,"length1":11,"diffs":[[1,"        }\n        constructor() {\n        }\n"]]},{"start1":902,"length1":0,"diffs":[[1,"    //% advanced\n    export function connectionSerial(): ConnectionSerial {\n        return _connectSerial\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n"]]},{"start1":1086,"length1":143,"diffs":[[1,"    export function startSerial(): void {\n        _connectSerial = new ConnectionSerial\n        custom.initialise();\n        custom.state.addConnection(_connectSerial)\n        connectionSerial().start()\n"]]}]}]},{"timestamp":1766169016145,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"pxt.json","patch":[{"start1":309,"length1":31,"diffs":[[1,"    \"preferredEditor\": \"blocksprj\"\n"]]}]},{"type":"edited","filename":"custom.ts","patch":[{"start1":416,"length1":0,"diffs":[[1,"        addConnection(c: Connection) {\n            this.connections.push(c);\n        }\n"]]},{"start1":848,"length1":208,"diffs":[[1,""]]},{"start1":985,"length1":374,"diffs":[[1,"            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n"]]}]},{"type":"edited","filename":"customble.ts","patch":[{"start1":280,"length1":40,"diffs":[[1,"            custom.state.addConnection(this);\n"]]}]},{"type":"edited","filename":"customserial.ts","patch":[{"start1":270,"length1":39,"diffs":[[1,"            custom.state.addConnection(this)\n"]]}]}]},{"timestamp":1766169625504,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"custom.ts","patch":[{"start1":4,"length1":17,"diffs":[[1," * Custom blocks\n"]]},{"start1":63,"length1":19,"diffs":[[1,"namespace custom {\n"]]}]}]},{"timestamp":1766169633608,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1108,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"33\" y=\"50\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"custom_useSerial\"><next><block type=\"custom_useBluetooth\"></block></next></block></next></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"548\" y=\"26\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"bluetooth_on_connected\" x=\"273\" y=\"41\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"device_forever\" x=\"595\" y=\"196\"></block><block type=\"custom_onCommand\" x=\"36\" y=\"310\"><statement name=\"HANDLER\"><block type=\"custom_sendString\"><value name=\"data\"><block type=\"text_join\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><shadow type=\"text\"><field name=\"TEXT\">echo </field></shadow></value><value name=\"ADD1\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"custom_command\"></block></value></block></value></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":84,"length1":84,"diffs":[[1,""]]},{"start1":169,"length1":41,"diffs":[[1,"custom.onCommand(function () {\n    custom.sendString(\"echo \" + custom.command())\n})\nbasic.showIcon(IconNames.Heart)\ncustom.useSerial()\ncustom.useBluetooth()\nbasic.forever(function () {\n\t\n})\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":309,"length1":35,"diffs":[[1,"    \"preferredEditor\": \"tsprj\"\n"]]}]},{"type":"edited","filename":"custom.ts","patch":[{"start1":463,"length1":34,"diffs":[[1,"    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function initialise(): void {\n"]]},{"start1":672,"length1":5,"diffs":[[1,"\n"]]},{"start1":730,"length1":39,"diffs":[[1,"    //% advanced\n    //% block\n    export function addConnection(c: Connection): void {\n"]]},{"start1":839,"length1":0,"diffs":[[1,"        state.connections.push(c);\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function startProcessing(): void {\n        initialise()\n"]]},{"start1":1106,"length1":47,"diffs":[[1,"            control.inBackground(function() {\n"]]},{"start1":1622,"length1":178,"diffs":[[1,""]]}]},{"type":"edited","filename":"customble.ts","patch":[{"start1":4,"length1":17,"diffs":[[1," * Custom blocks\n"]]},{"start1":63,"length1":19,"diffs":[[1,"namespace custom {\n"]]},{"start1":247,"length1":40,"diffs":[[1,"            custom.initialise();\n            custom.addConnection(this);\n"]]},{"start1":414,"length1":102,"diffs":[[1,"                custom.onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n"]]}]},{"type":"edited","filename":"customserial.ts","patch":[{"start1":4,"length1":17,"diffs":[[1," * Custom blocks\n"]]},{"start1":63,"length1":19,"diffs":[[1,"namespace custom {\n"]]},{"start1":237,"length1":39,"diffs":[[1,"            custom.initialise();\n            custom.addConnection(this)\n"]]},{"start1":554,"length1":95,"diffs":[[1,"                custom.onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n"]]},{"start1":664,"length1":10,"diffs":[[1,"         }\n"]]}]}]},{"timestamp":1766170233399,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":727,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"6\" y=\"-60\"><statement name=\"HANDLER\"><block type=\"remote_useSerial\"><next><block type=\"remote_useBluetooth\"></block></next></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"503\" y=\"-57\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"remote_onCommand\" x=\"5\" y=\"149\"><statement name=\"HANDLER\"><block type=\"remote_sendString\"><value name=\"data\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"text_join\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><shadow type=\"text\"><field name=\"TEXT\">echo </field></shadow></value><value name=\"ADD1\"><shadow type=\"text\"><field name=\"TEXT\">World</field></shadow><block type=\"remote_command\"></block></value></block></value></block></statement></block><block type=\"bluetooth_on_connected\" x=\"503\" y=\"137\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":0,"diffs":[[1,"bluetooth.onBluetoothConnected(function () {\n    basic.showIcon(IconNames.Happy)\n})\n"]]},{"start1":168,"length1":0,"diffs":[[1,"bluetooth.onBluetoothDisconnected(function () {\n    basic.showIcon(IconNames.Sad)\n})\n"]]},{"start1":272,"length1":32,"diffs":[[1,"remote.useBluetooth()\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":2,"length1":22,"diffs":[[1,"    \"name\": \"transports\",\n"]]},{"start1":231,"length1":96,"diffs":[[1,"        \"custom.ts\",\n        \"customble.ts\",\n        \"customserial.ts\"\n"]]}]},{"type":"removed","filename":"customserial.ts","value":"/**\n * Remote blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace remote {\n    class ConnectionSerial implements Connection {\n        sendString(data: string) {\n            serial.writeLine(data)\n        }\n        constructor() {\n            remote.addConnection(this)\n            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                this.active = true;\n                remote.onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n        }\n    }\n    let _connectSerial: ConnectionSerial = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function useSerial(): void {\n        if (_connectSerial == undefined) {\n            _connectSerial = new ConnectionSerial\n        }\n    }\n}\n"},{"type":"removed","filename":"customble.ts","value":"/**\n * Remote blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace remote {\n    class ConnectBluetooth implements Connection {\n        sendString( data: string) {\n            bluetooth.uartWriteString(data)\n        }\n        constructor() {\n            remote.addConnection(this);\n            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                remote.onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            bluetooth.startUartService()\n        }\n    }\n    let _connectBluetooth: ConnectBluetooth = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function useBluetooth(): void {\n        if (_connectBluetooth == undefined) {\n            _connectBluetooth = new ConnectBluetooth\n        }\n    }\n}\n"},{"type":"removed","filename":"custom.ts","value":"/**\n * Remote blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace remote {\n    export interface Connection {\n        sendString(data: string): void\n    }\n\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand: string = \"\"\n        processing: boolean = false\n        connections: Connection[] = [];\n        constructor() {\n        }\n    }\n    export let state: State = undefined\n\n    function initialise(): void {\n        if (state == undefined) {\n            state = new State\n        }\n    }\n    \n    /**\n     * TODO: describe your function here\n     */\n    function startProcessing(): void {\n        initialise()\n        if (!state.processing) {\n            state.processing = true;\n            control.inBackground(function () {\n                while (state.processing) {\n                    if (state.receivedCommands.length) {\n                        state.receivedCommand = state.receivedCommands[0]\n                        state.receivedCommands.removeElement(state.receivedCommand)\n                        state.commandsHandler()\n                    }\n                    basic.pause(0)\n                }\n            })\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    export function addConnection(c: Connection): void {\n        initialise()\n        state.connections.push(c);\n    }\n\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function onDataReceived(command: string) {\n        initialise()\n        state.receivedCommands.push(command)\n        startProcessing()\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendString(data: string) {\n        initialise()\n        for (let index = 0; index < state.connections.length; index++) {\n            state.connections[index].sendString(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n"},{"type":"added","filename":"remote.ts","value":"/**\n * Remote blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace remote {\n    export interface Connection {\n        sendString(data: string): void\n    }\n\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand: string = \"\"\n        processing: boolean = false\n        connections: Connection[] = [];\n        constructor() {\n        }\n    }\n    export let state: State = undefined\n\n    function initialise(): void {\n        if (state == undefined) {\n            state = new State\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    function startProcessing(): void {\n        initialise()\n        if (!state.processing) {\n            state.processing = true;\n            control.inBackground(function () {\n                while (state.processing) {\n                    if (state.receivedCommands.length) {\n                        state.receivedCommand = state.receivedCommands[0]\n                        state.receivedCommands.removeElement(state.receivedCommand)\n                        state.commandsHandler()\n                    }\n                    basic.pause(0)\n                }\n            })\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    export function addConnection(c: Connection): void {\n        initialise()\n        state.connections.push(c);\n    }\n\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function onDataReceived(command: string) {\n        initialise()\n        state.receivedCommands.push(command)\n        startProcessing()\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendString(data: string) {\n        initialise()\n        for (let index = 0; index < state.connections.length; index++) {\n            state.connections[index].sendString(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n"},{"type":"added","filename":"remoteSerial.ts","value":"/**\n * Remote blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace remote {\n    class ConnectionSerial implements Connection {\n        sendString(data: string) {\n            serial.writeLine(data)\n        }\n        constructor() {\n            remote.addConnection(this)\n            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                this.active = true;\n                remote.onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n        }\n    }\n    let _connectSerial: ConnectionSerial = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function useSerial(): void {\n        if (_connectSerial == undefined) {\n            _connectSerial = new ConnectionSerial\n        }\n    }\n}\n"},{"type":"added","filename":"remoteBluetooth.ts","value":"/**\n * Remote blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace remote {\n    class ConnectBluetooth implements Connection {\n        sendString(data: string) {\n            bluetooth.uartWriteString(data)\n        }\n        constructor() {\n            remote.addConnection(this);\n            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                remote.onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            bluetooth.startUartService()\n        }\n    }\n    let _connectBluetooth: ConnectBluetooth = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function useBluetooth(): void {\n        if (_connectBluetooth == undefined) {\n            _connectBluetooth = new ConnectBluetooth\n        }\n    }\n}\n"},{"type":"added","filename":"test.ts","value":"// Add your code here\n"}]},{"timestamp":1766170827880,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"pxt.json","patch":[{"start1":340,"length1":31,"diffs":[[1,"    \"preferredEditor\": \"blocksprj\"\n"]]}]}]},{"timestamp":1766175813751,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"pxt.json","patch":[{"start1":237,"length1":0,"diffs":[[1,"        \"remote.ts\",\n"]]}]},{"type":"removed","filename":"remote.ts","value":"/**\n * Remote blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace remote {\n    export interface Connection {\n        sendString(data: string): void\n    }\n\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand: string = \"\"\n        processing: boolean = false\n        connections: Connection[] = [];\n        constructor() {\n        }\n    }\n    export let state: State = undefined\n\n    function initialise(): void {\n        if (state == undefined) {\n            state = new State\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    function startProcessing(): void {\n        initialise()\n        if (!state.processing) {\n            state.processing = true;\n            control.inBackground(function () {\n                while (state.processing) {\n                    if (state.receivedCommands.length) {\n                        state.receivedCommand = state.receivedCommands[0]\n                        state.receivedCommands.removeElement(state.receivedCommand)\n                        state.commandsHandler()\n                    }\n                    basic.pause(0)\n                }\n            })\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    export function addConnection(c: Connection): void {\n        initialise()\n        state.connections.push(c);\n    }\n\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function onDataReceived(command: string) {\n        initialise()\n        state.receivedCommands.push(command)\n        startProcessing()\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendString(data: string) {\n        initialise()\n        for (let index = 0; index < state.connections.length; index++) {\n            state.connections[index].sendString(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n"}]},{"timestamp":1766175842098,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":1,"diffs":[[1,"remote.onCommand(function () {\n    remote.sendString(\"echo \" + remote.command())\n})\nremote.useSerial()\nbasic.showIcon(IconNames.Heart)\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":174,"length1":0,"diffs":[[1,"        \"main.blocks\",\n"]]},{"start1":237,"length1":0,"diffs":[[1,"        \"remoteSerial.ts\",\n"]]},{"start1":319,"length1":44,"diffs":[[1,""]]}]},{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":127,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"remote_useSerial\"><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field></block></next></block></statement></block><block type=\"remote_onCommand\" x=\"7\" y=\"212\"><statement name=\"HANDLER\"><block type=\"remote_sendString\"><value name=\"data\"><block type=\"text_join\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><shadow type=\"text\"><field name=\"TEXT\">echo </field></shadow></value><value name=\"ADD1\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"remote_command\"></block></value></block></value></block></statement></block></xml>"]]}]},{"type":"removed","filename":"remoteSerial.ts","value":"/**\n * Remote blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace remote {\n    class ConnectionSerial implements Connection {\n        sendString(data: string) {\n            serial.writeLine(data)\n        }\n        constructor() {\n            remote.addConnection(this)\n            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                this.active = true;\n                remote.onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n        }\n    }\n    let _connectSerial: ConnectionSerial = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function useSerial(): void {\n        if (_connectSerial == undefined) {\n            _connectSerial = new ConnectionSerial\n        }\n    }\n}\n"}]}],"snapshots":[{"timestamp":1766099103786,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>","main.ts":"\n","README.md":"","pxt.json":"{\n    \"name\": \"init-on-demand\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"additionalFilePaths\": []\n}\n"}},{"timestamp":1766100907689,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"20\" y=\"20\"></block><block type=\"device_forever\" x=\"225\" y=\"20\"></block></xml>","main.ts":"basic.forever(function () {\n\t\n})\n","README.md":"","custom.ts":"\n/**\n* Use this file to define custom functions and blocks.\n* Read more at https://makecode.microbit.org/blocks/custom\n*/\n\nenum MyEnum {\n    //% block=\"one\"\n    One,\n    //% block=\"two\"\n    Two\n}\n\n/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands : string [] = []\n        receivedCommand = \"\"\n        receivedBLE: boolean = false\n        receivedSerial: boolean = false\n        constructor() {\n        }\n    }\n\n    let state : State = undefined\n    function initialise(): void {\n        if (state == undefined) {\n            state = new State\n            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                state.receivedBLE = true\n                onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                state.receivedSerial = true;\n                onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.command = state.receivedSerial\n                    commandName = Object.keys(latestCommands)[0]\n                    commandValue = latestCommands[commandName]\n                    delete latestCommands[commandName];\n\n                    setup()\n                    commandsHandler()\n                }\n            })\n        }\n    }\n\n    function onDataReceived(command: string) {\n        state.lastCommand = command\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param value describe value here, eg: 5\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        if (state.receivedBLE) {\n            bluetooth.uartWriteLine(data)\n        }\n        if (state.receivedBLE) {\n            serial.writeLine(data)\n        }\n    }\n\n    \n    /**\n     * TODO: describe your function here\n     * @param value describe value here, eg: 5\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n","pxt.json":"{\n    \"name\": \"init-on-demand\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"microphone\": \"*\",\n        \"bluetooth\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"custom.ts\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}},{"timestamp":1766102707730,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field></block></statement></block><block type=\"device_forever\" x=\"260\" y=\"4\"></block><block type=\"bluetooth_on_connected\" x=\"485\" y=\"-6\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"custom_onCommand\" x=\"-1\" y=\"166\"><statement name=\"HANDLER\"><block type=\"custom_sendData\"><value name=\"data\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"custom_command\"></block></value></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"483\" y=\"153\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block></xml>","main.ts":"bluetooth.onBluetoothConnected(function () {\n    basic.showIcon(IconNames.Happy)\n})\nbluetooth.onBluetoothDisconnected(function () {\n    basic.showIcon(IconNames.Sad)\n})\ncustom.onCommand(function () {\n    custom.sendData(custom.command())\n})\nbasic.showIcon(IconNames.Heart)\nbasic.forever(function () {\n\t\n})\n","README.md":"","custom.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands : string [] = []\n        receivedCommand = \"\"\n        receivedBLE: boolean = false\n        receivedSerial: boolean = false\n        constructor() {\n        }\n    }\n\n    let state : State = undefined\n    \n    function initialise(): void {\n        if (state == undefined) {\n            serial.writeLine(\"init\")\n            state = new State\n            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                state.receivedBLE = true\n                onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                serial.writeLine(\"serial\")\n                state.receivedSerial = true;\n                onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                }\n            })\n            bluetooth.startUartService()\n        }\n    }\n\n    function onDataReceived(command: string) {\n        serial.writeLine(\"received \" + command)\n        serial.writeLine(\"received \" + command)\n        state.receivedCommands.push( command)\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        if (state.receivedBLE) {\n            bluetooth.uartWriteLine(data)\n        }\n        if (state.receivedBLE) {\n            serial.writeLine(data)\n        }\n    }\n\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n","pxt.json":"{\n    \"name\": \"init-on-demand\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"microphone\": \"*\",\n        \"bluetooth\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"custom.ts\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}},{"timestamp":1766146091035,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field></block></statement></block><block type=\"device_forever\" x=\"260\" y=\"4\"></block><block type=\"bluetooth_on_connected\" x=\"485\" y=\"-6\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"custom_onCommand\" x=\"-1\" y=\"166\"><statement name=\"HANDLER\"><block type=\"custom_sendData\"><value name=\"data\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"custom_command\"></block></value></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"483\" y=\"153\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block></xml>","main.ts":"bluetooth.onBluetoothConnected(function () {\n    basic.showIcon(IconNames.Happy)\n})\nbluetooth.onBluetoothDisconnected(function () {\n    basic.showIcon(IconNames.Sad)\n})\ncustom.onCommand(function () {\n    custom.sendData(custom.command())\n})\nbasic.showIcon(IconNames.Heart)\nbasic.forever(function () {\n\t\n})\n","README.md":"","custom.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands : string [] = []\n        receivedCommand = \"\"\n        receivedBLE: boolean = false\n        receivedSerial: boolean = false\n        constructor() {\n        }\n    }\n\n    let state : State = undefined\n    \n    function initialise(): void {\n        if (state == undefined) {\n            serial.writeLine(\"init\")\n            state = new State\n            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                state.receivedBLE = true\n                onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                serial.writeLine(\"serial\")\n                state.receivedSerial = true;\n                onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                    basic.pause(0)\n                }\n            })\n            bluetooth.startUartService()\n        }\n    }\n\n    function onDataReceived(command: string) {\n        serial.writeLine(\"received \")\n        serial.writeLine(command)\n        state.receivedCommands.push( command)\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        if (state.receivedBLE) {\n            bluetooth.uartWriteLine(data)\n        }\n        if (state.receivedBLE) {\n            serial.writeLine(data)\n        }\n    }\n\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n","pxt.json":"{\n    \"name\": \"init-on-demand\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"microphone\": \"*\",\n        \"bluetooth\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"custom.ts\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}},{"timestamp":1766148475906,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field></block></statement></block><block type=\"device_forever\" x=\"260\" y=\"4\"></block><block type=\"bluetooth_on_connected\" x=\"485\" y=\"-6\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"483\" y=\"153\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"custom_onCommand\" x=\"0\" y=\"207\"><statement name=\"HANDLER\"><block type=\"custom_sendData\"><value name=\"data\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"custom_command\"></block></value></block></statement></block></xml>","main.ts":"bluetooth.onBluetoothConnected(function () {\n    basic.showIcon(IconNames.Happy)\n})\nbluetooth.onBluetoothDisconnected(function () {\n    basic.showIcon(IconNames.Sad)\n})\ncustom.onCommand(function () {\n    custom.sendData(custom.command())\n})\nbasic.showIcon(IconNames.Heart)\nbasic.forever(function () {\n\t\n})\n","README.md":"","custom.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands : string [] = []\n        receivedCommand = \"\"\n        receivedBLE: boolean = false\n        receivedSerial: boolean = false\n        constructor() {\n        }\n    }\n\n    let state : State = undefined\n    \n    function initialise(): void {\n        if (state == undefined) {\n            state = new State\n            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                state.receivedBLE = true\n                onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                state.receivedSerial = true;\n                onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                    basic.pause(0)\n                }\n            })\n            bluetooth.startUartService()\n        }\n    }\n\n    function onDataReceived(command: string) {\n        state.receivedCommands.push( command)\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        if (state.receivedBLE) {\n            bluetooth.uartWriteLine(data)\n        }\n        if (state.receivedBLE) {\n            serial.writeLine(data)\n        }\n    }\n\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n","pxt.json":"{\n    \"name\": \"init-on-demand\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"microphone\": \"*\",\n        \"bluetooth\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"custom.ts\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}},{"timestamp":1766150295817,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field></block></statement></block><block type=\"device_forever\" x=\"260\" y=\"4\"></block><block type=\"bluetooth_on_connected\" x=\"485\" y=\"-6\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"483\" y=\"153\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"custom_onCommand\" x=\"0\" y=\"207\"><statement name=\"HANDLER\"><block type=\"custom_sendData\"><value name=\"data\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"custom_command\"></block></value></block></statement></block></xml>","main.ts":"bluetooth.onBluetoothConnected(function () {\n    basic.showIcon(IconNames.Happy)\n})\nbluetooth.onBluetoothDisconnected(function () {\n    basic.showIcon(IconNames.Sad)\n})\ncustom.onCommand(function () {\n    custom.sendData(custom.command())\n})\nbasic.showIcon(IconNames.Heart)\nbasic.forever(function () {\n\t\n})\n","README.md":"","custom.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands : string [] = []\n        receivedCommand = \"\"\n        receivedBLE: boolean = false\n        receivedSerial: boolean = false\n        sendHandler: ((string) => void)[] = [];\n        constructor() {\n        }\n    }\n\n    let state : State = undefined\n    \n    function initialise(): void {\n        if (state == undefined) {\n            state = new State\n            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            try {\n                bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                    state.receivedBLE = true\n                    onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n                })\n            } catch (e) {\n\n            }\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                state.receivedSerial = true;\n                onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                    basic.pause(0)\n                }\n            })\n            try {\n                bluetooth.startUartService()\n            } catch (e) {\n\n            }\n        }\n    }\n\n    function onDataReceived(command: string) {\n        state.receivedCommands.push( command)\n    }\n    \n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        if (state.receivedBLE) {\n            try {\n                bluetooth.uartWriteLine(data)\n            } catch (e) {\n\n            }\n        }\n        if (state.receivedBLE) {\n            serial.writeLine(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        if (state.receivedBLE) {\n            try {\n                bluetooth.uartWriteLine(data)\n            } catch (e) {\n\n            }\n        }\n        if (state.receivedBLE) {\n            serial.writeLine(data)\n        }\n    }\n\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n","customble.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand = \"\"\n        receivedBLE: boolean = false\n        receivedSerial: boolean = false\n        constructor() {\n        }\n    }\n\n    let state: State = undefined\n\n    function initialise(): void {\n        if (state == undefined) {\n            state = new State\n            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            try {\n                bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                    state.receivedBLE = true\n                    onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n                })\n            } catch (e) {\n\n            }\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                state.receivedSerial = true;\n                onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                    basic.pause(0)\n                }\n            })\n            try {\n                bluetooth.startUartService()\n            } catch (e) {\n\n            }\n        }\n    }\n\n    function onDataReceived(command: string) {\n        state.receivedCommands.push(command)\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        if (state.receivedBLE) {\n            try {\n                bluetooth.uartWriteLine(data)\n            } catch (e) {\n\n            }\n        }\n        if (state.receivedBLE) {\n            serial.writeLine(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        if (state.receivedBLE) {\n            try {\n                bluetooth.uartWriteLine(data)\n            } catch (e) {\n\n            }\n        }\n        if (state.receivedBLE) {\n            serial.writeLine(data)\n        }\n    }\n}\n","pxt.json":"{\n    \"name\": \"init-on-demand\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"microphone\": \"*\",\n        \"bluetooth\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"custom.ts\",\n        \"customble.ts\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}},{"timestamp":1766157682645,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field></block></statement></block><block type=\"device_forever\" x=\"260\" y=\"4\"></block><block type=\"bluetooth_on_connected\" x=\"485\" y=\"-6\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"483\" y=\"153\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"custom_onCommand\" x=\"0\" y=\"207\"><statement name=\"HANDLER\"><block type=\"custom_sendData\"><value name=\"data\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"custom_command\"></block></value></block></statement></block></xml>","main.ts":"bluetooth.onBluetoothConnected(function () {\n    basic.showIcon(IconNames.Happy)\n})\nbluetooth.onBluetoothDisconnected(function () {\n    basic.showIcon(IconNames.Sad)\n})\ncustom.onCommand(function () {\n    custom.sendData(custom.command())\n})\nbasic.showIcon(IconNames.Heart)\nbasic.forever(function () {\n\t\n})\n","README.md":"","custom.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    export interface Transport {\n        sendString(data: string): void\n    }\n\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand = \"\"\n        transports: Transport[] = [];\n        constructor() {\n        }\n    }\n    export let state : State = undefined\n    \n    function initialise(): void {\n        if (state == undefined) {\n            state = new State\n            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                    basic.pause(0)\n                }\n            })\n        }\n    }\n\n    function onDataReceived(command: string) {\n        state.receivedCommands.push( command)\n    }\n    \n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        for (let index = 0; index < state.transports.length; index++) {\n            state.transports[index].sendData(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n","customble.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class TransportBLE implements Transport {\n        active = false\n        sendString( data: string) {\n            if ( this.active) {\n                bluetooth.uartWriteString(data)\n            }\n        }\n        start() {\n            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                this.active = true\n                custom.onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            bluetooth.startUartService()\n        }\n        constructor() {\n            custom.initialise();\n            custom.state.transports.push(this);\n        }\n    }\n    transportBLE: TransportBLE = undefined\n    \n}\n","customserial.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class Transport {\n        active: boolean = false\n        sendHandler: (data: string) => void = (data: string) => { };\n        constructor() {\n        }\n    }\n\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand = \"\"\n        transports: Transport[] = [];\n        constructor() {\n        }\n    }\n\n\n    let state: State = undefined\n\n    function initialise(): void {\n        if (state == undefined) {\n            state = new State\n            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            try {\n                bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                    state.receivedBLE = true\n                    onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n                })\n            } catch (e) {\n\n            }\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                state.receivedSerial = true;\n                onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                    basic.pause(0)\n                }\n            })\n            try {\n                bluetooth.startUartService()\n            } catch (e) {\n\n            }\n        }\n    }\n\n    function onDataReceived(command: string) {\n        state.receivedCommands.push(command)\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendData(data: string) {\n        initialise()\n        for (let index = 0; index < state.sendHandlers.length; index++) {\n            state.sendHandlers(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n","pxt.json":"{\n    \"name\": \"init-on-demand\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"microphone\": \"*\",\n        \"bluetooth\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"custom.ts\",\n        \"customble.ts\",\n        \"customserial.ts\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}},{"timestamp":1766159485434,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"21\" y=\"14\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"custom_startSerial\"><next><block type=\"custom_startBluetooth\"></block></next></block></next></block></statement></block><block type=\"bluetooth_on_connected\" x=\"239\" y=\"13\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"494\" y=\"13\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"device_forever\" x=\"398\" y=\"189\"></block><block type=\"custom_onCommand\" x=\"21\" y=\"272\"><statement name=\"HANDLER\"><block type=\"custom_sendString\"><value name=\"data\"><block type=\"text_join\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><shadow type=\"text\"><field name=\"TEXT\">echo </field></shadow></value><value name=\"ADD1\"><shadow type=\"text\"><field name=\"TEXT\">World</field></shadow><block type=\"custom_command\"></block></value></block></value></block></statement></block></xml>","main.ts":"bluetooth.onBluetoothConnected(function () {\n    basic.showIcon(IconNames.Happy)\n})\nbluetooth.onBluetoothDisconnected(function () {\n    basic.showIcon(IconNames.Sad)\n})\ncustom.onCommand(function () {\n    custom.sendString(\"echo \" + custom.command())\n})\nbasic.showIcon(IconNames.Heart)\ncustom.startSerial()\ncustom.startBluetooth()\nbasic.forever(function () {\n\t\n})\n","README.md":"","custom.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    export interface Transport {\n        sendString(data: string): void\n    }\n\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand: string = \"\"\n        processing: boolean = false\n        transports: Transport[] = [];\n        constructor() {\n        }\n    }\n    export let state: State = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function startProcessing(): void {\n        initialise()\n        if (!state.processing) {\n            state.processing = true;\n            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                    basic.pause(0)\n                }\n            })\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function initialise(): void {\n        if (state == undefined) {\n            state = new State\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function onDataReceived(command: string) {\n        initialise()\n        state.receivedCommands.push(command)\n        startProcessing()\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendString(data: string) {\n        initialise()\n        for (let index = 0; index < state.transports.length; index++) {\n            state.transports[index].sendString(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n","customble.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class TransportBLE implements Transport {\n        active = false\n        sendString( data: string) {\n            if ( this.active) {\n                bluetooth.uartWriteString(data)\n            }\n        }\n        start() {\n            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                this.active = true\n                custom.onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            bluetooth.startUartService()\n        }\n        constructor() {\n            custom.initialise();\n            custom.state.transports.push(this);\n        }\n    }\n    let _transportBLE: TransportBLE = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function transportBluetooth(): TransportBLE {\n        return _transportBLE\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function startBluetooth(): void {\n        _transportBLE = new TransportBLE\n        _transportBLE.start()\n    }\n}\n","customserial.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class TransportSerial implements Transport {\n        active = false\n        sendString(data: string) {\n            if (this.active) {\n                serial.writeLine(data)\n            }\n        }\n        start() {\n            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                this.active = true;\n                custom.onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n        }\n        constructor() {\n            custom.initialise();\n            custom.state.transports.push(this);\n        }\n    }\n    let _transportSerial: TransportSerial = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function transportSerial(): TransportSerial {\n        return _transportSerial\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function startSerial(): void {\n        _transportSerial = new TransportSerial\n        _transportSerial.start()\n    }}\n","pxt.json":"{\n    \"name\": \"transports\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"microphone\": \"*\",\n        \"bluetooth\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"custom.ts\",\n        \"customble.ts\",\n        \"customserial.ts\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}},{"timestamp":1766166122037,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"custom_startSerial\"><next><block type=\"custom_startBluetooth\"></block></next></block></next></block></statement></block><block type=\"bluetooth_on_connected\" x=\"218\" y=\"-1\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"473\" y=\"-1\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"device_forever\" x=\"377\" y=\"175\"></block><block type=\"custom_onCommand\" x=\"0\" y=\"258\"><statement name=\"HANDLER\"><block type=\"custom_sendString\"><value name=\"data\"><block type=\"text_join\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><shadow type=\"text\"><field name=\"TEXT\">echo </field></shadow></value><value name=\"ADD1\"><shadow type=\"text\"><field name=\"TEXT\">World</field></shadow><block type=\"custom_command\"></block></value></block></value></block></statement></block></xml>","main.ts":"bluetooth.onBluetoothConnected(function () {\n    basic.showIcon(IconNames.Happy)\n})\nbluetooth.onBluetoothDisconnected(function () {\n    basic.showIcon(IconNames.Sad)\n})\ncustom.onCommand(function () {\n    custom.sendString(\"echo \" + custom.command())\n})\nbasic.showIcon(IconNames.Heart)\ncustom.startSerial()\ncustom.startBluetooth()\nbasic.forever(function () {\n\t\n})\n","README.md":"","custom.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    export interface Transport {\n        sendString(data: string): void\n    }\n\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand: string = \"\"\n        processing: boolean = false\n        transports: Transport[] = [];\n        constructor() {\n        }\n    }\n    export let state: State = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function startProcessing(): void {\n        initialise()\n        if (!state.processing) {\n            state.processing = true;\n            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                    basic.pause(0)\n                }\n            })\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function initialise(): void {\n        if (state == undefined) {\n            state = new State\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function onDataReceived(command: string) {\n        initialise()\n        state.receivedCommands.push(command)\n        startProcessing()\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendString(data: string) {\n        initialise()\n        for (let index = 0; index < state.transports.length; index++) {\n            state.transports[index].sendString(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n","customble.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class TransportBLE implements Transport {\n        active = false\n        sendString( data: string) {\n            if ( this.active) {\n                bluetooth.uartWriteString(data)\n            }\n        }\n        start() {\n            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                this.active = true\n                custom.onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            bluetooth.startUartService()\n        }\n        constructor() {\n            custom.initialise();\n            custom.state.transports.push(this);\n        }\n    }\n    let _transportBLE: TransportBLE = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    export function transportBluetooth(): TransportBLE {\n        return _transportBLE\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function startBluetooth(): void {\n        _transportBLE = new TransportBLE\n        _transportBLE.start()\n    }\n}\n","customserial.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class TransportSerial implements Transport {\n        active = false\n        sendString(data: string) {\n            if (this.active) {\n                serial.writeLine(data)\n            }\n        }\n        start() {\n            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                this.active = true;\n                custom.onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n        }\n        constructor() {\n        }\n    }\n    let _transportSerial: TransportSerial = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    export function transportSerial(): TransportSerial {\n        return _transportSerial\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function startSerial(): void {\n        _transportSerial = new TransportSerial\n        custom.initialise();\n        custom.state.transports.push(_transportSerial);\n        _transportSerial.start()\n    }\n}\n","pxt.json":"{\n    \"name\": \"transports\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"microphone\": \"*\",\n        \"bluetooth\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"custom.ts\",\n        \"customble.ts\",\n        \"customserial.ts\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}},{"timestamp":1766167940376,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"custom_startSerial\"><next><block type=\"custom_startBluetooth\"></block></next></block></next></block></statement></block><block type=\"bluetooth_on_connected\" x=\"218\" y=\"-1\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"473\" y=\"-1\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"device_forever\" x=\"377\" y=\"175\"></block><block type=\"custom_onCommand\" x=\"0\" y=\"258\"><statement name=\"HANDLER\"><block type=\"custom_sendString\"><value name=\"data\"><block type=\"text_join\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><shadow type=\"text\"><field name=\"TEXT\">echo </field></shadow></value><value name=\"ADD1\"><shadow type=\"text\"><field name=\"TEXT\">World</field></shadow><block type=\"custom_command\"></block></value></block></value></block></statement></block></xml>","main.ts":"bluetooth.onBluetoothConnected(function () {\n    basic.showIcon(IconNames.Happy)\n})\nbluetooth.onBluetoothDisconnected(function () {\n    basic.showIcon(IconNames.Sad)\n})\ncustom.onCommand(function () {\n    custom.sendString(\"echo \" + custom.command())\n})\nbasic.showIcon(IconNames.Heart)\ncustom.startSerial()\ncustom.startBluetooth()\nbasic.forever(function () {\n\t\n})\n","README.md":"","custom.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    export interface Connection {\n        sendString(data: string): void\n    }\n\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand: string = \"\"\n        processing: boolean = false\n        connections: Connection[] = [];\n        constructor() {\n        }\n        addConnection(c: Connection) {\n            this.connections.push(c);\n        }\n    }\n    export let state: State = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function initialise(): void {\n        if (state == undefined) {\n            state = new State\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function startProcessing(): void {\n        initialise()\n        if (!state.processing) {\n            state.processing = true;\n            basic.forever(function () {\n                while (state.receivedCommands.length) {\n                    state.receivedCommand = state.receivedCommands[0]\n                    state.receivedCommands.removeElement(state.receivedCommand)\n                    state.commandsHandler()\n                    basic.pause(0)\n                }\n            })\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function onDataReceived(command: string) {\n        initialise()\n        state.receivedCommands.push(command)\n        startProcessing()\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendString(data: string) {\n        initialise()\n        for (let index = 0; index < state.connections.length; index++) {\n            state.connections[index].sendString(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n","customble.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class ConnectBluetooth implements Connection {\n        active = false\n        sendString( data: string) {\n            if ( this.active) {\n                bluetooth.uartWriteString(data)\n            }\n        }\n        start() {\n            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                this.active = true\n                custom.onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            bluetooth.startUartService()\n        }\n        constructor() {\n        }\n    }\n    let _connectBluetooth: ConnectBluetooth = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    export function connectBluetooth(): ConnectBluetooth {\n        return _connectBluetooth\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function startBluetooth(): void {\n        _connectBluetooth = new ConnectBluetooth\n        custom.initialise();\n        custom.state.connections.push(_connectBluetooth);\n        connectBluetooth().start()\n    }\n}\n","customserial.ts":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace custom {\n    class ConnectionSerial implements Connection {\n        _active = false\n        active(): boolean { return _active }\n        sendString(data: string) {\n            if (this.active) {\n                serial.writeLine(data)\n            }\n        }\n        start() {\n            this.active = true;\n            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                this.active = true;\n                custom.onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n        }\n        constructor() {\n        }\n    }\n    let _connectSerial: ConnectionSerial = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    export function connectionSerial(): ConnectionSerial {\n        return _connectSerial\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function startSerial(): void {\n        _connectSerial = new ConnectionSerial\n        custom.initialise();\n        custom.state.addConnection(_connectSerial)\n        connectionSerial().start()\n    }\n}\n","pxt.json":"{\n    \"name\": \"transports\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"microphone\": \"*\",\n        \"bluetooth\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"custom.ts\",\n        \"customble.ts\",\n        \"customserial.ts\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}},{"timestamp":1766169824290,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"33\" y=\"50\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><next><block type=\"custom_useSerial\"><next><block type=\"custom_useBluetooth\"></block></next></block></next></block></statement></block><block type=\"bluetooth_on_disconnected\" x=\"548\" y=\"26\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></statement></block><block type=\"bluetooth_on_connected\" x=\"273\" y=\"41\"><statement name=\"HANDLER\"><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></statement></block><block type=\"device_forever\" x=\"595\" y=\"196\"></block><block type=\"custom_onCommand\" x=\"36\" y=\"310\"><statement name=\"HANDLER\"><block type=\"custom_sendString\"><value name=\"data\"><block type=\"text_join\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><shadow type=\"text\"><field name=\"TEXT\">echo </field></shadow></value><value name=\"ADD1\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"custom_command\"></block></value></block></value></block></statement></block></xml>","main.ts":"bluetooth.onBluetoothConnected(function () {\n    basic.showIcon(IconNames.Happy)\n})\nbluetooth.onBluetoothDisconnected(function () {\n    basic.showIcon(IconNames.Sad)\n})\nremote.onCommand(function () {\n    remote.sendString(\"echo \" + remote.command())\n})\nbasic.showIcon(IconNames.Heart)\nremote.useSerial()\nremote.useBluetooth()\nbasic.forever(function () {\n\t\n})\n","README.md":"","custom.ts":"/**\n * Remote blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace remote {\n    export interface Connection {\n        sendString(data: string): void\n    }\n\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand: string = \"\"\n        processing: boolean = false\n        connections: Connection[] = [];\n        constructor() {\n        }\n    }\n    export let state: State = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function initialise(): void {\n        if (state == undefined) {\n            state = new State\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function addConnection(c: Connection): void {\n        initialise()\n        state.connections.push(c);\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function startProcessing(): void {\n        initialise()\n        if (!state.processing) {\n            state.processing = true;\n            control.inBackground(function() {\n                while (state.processing) {\n                    if (state.receivedCommands.length) {\n                        state.receivedCommand = state.receivedCommands[0]\n                        state.receivedCommands.removeElement(state.receivedCommand)\n                        state.commandsHandler()\n                    }\n                    basic.pause(0)\n                }\n            })\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function onDataReceived(command: string) {\n        initialise()\n        state.receivedCommands.push(command)\n        startProcessing()\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendString(data: string) {\n        initialise()\n        for (let index = 0; index < state.connections.length; index++) {\n            state.connections[index].sendString(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n","customble.ts":"/**\n * Remote blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace remote {\n    class ConnectBluetooth implements Connection {\n        sendString( data: string) {\n            bluetooth.uartWriteString(data)\n        }\n        constructor() {\n            remote.initialise();\n            remote.addConnection(this);\n            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                remote.onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            bluetooth.startUartService()\n        }\n    }\n    let _connectBluetooth: ConnectBluetooth = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function useBluetooth(): void {\n        if (_connectBluetooth == undefined) {\n            _connectBluetooth = new ConnectBluetooth\n        }\n    }\n}\n","customserial.ts":"/**\n * Remote blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace remote {\n    class ConnectionSerial implements Connection {\n        sendString(data: string) {\n            serial.writeLine(data)\n        }\n        constructor() {\n            remote.initialise();\n            remote.addConnection(this)\n            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                this.active = true;\n                remote.onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n         }\n    }\n    let _connectSerial: ConnectionSerial = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function useSerial(): void {\n        if (_connectSerial == undefined) {\n            _connectSerial = new ConnectionSerial\n        }\n    }\n}\n","pxt.json":"{\n    \"name\": \"transports\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"microphone\": \"*\",\n        \"bluetooth\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"custom.ts\",\n        \"customble.ts\",\n        \"customserial.ts\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}},{"timestamp":1766175813751,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"remote_useSerial\"><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field></block></next></block></statement></block><block type=\"remote_onCommand\" x=\"7\" y=\"212\"><statement name=\"HANDLER\"><block type=\"remote_sendString\"><value name=\"data\"><block type=\"text_join\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><shadow type=\"text\"><field name=\"TEXT\">echo </field></shadow></value><value name=\"ADD1\"><shadow type=\"text\"><field name=\"TEXT\"></field></shadow><block type=\"remote_command\"></block></value></block></value></block></statement></block></xml>","main.ts":"","README.md":"","remote.ts":"/**\n * Remote blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace remote {\n    export interface Connection {\n        sendString(data: string): void\n    }\n\n    class State {\n        commandsHandler: () => void = () => { };\n        receivedCommands: string[] = []\n        receivedCommand: string = \"\"\n        processing: boolean = false\n        connections: Connection[] = [];\n        constructor() {\n        }\n    }\n    export let state: State = undefined\n\n    function initialise(): void {\n        if (state == undefined) {\n            state = new State\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    function startProcessing(): void {\n        initialise()\n        if (!state.processing) {\n            state.processing = true;\n            control.inBackground(function () {\n                while (state.processing) {\n                    if (state.receivedCommands.length) {\n                        state.receivedCommand = state.receivedCommands[0]\n                        state.receivedCommands.removeElement(state.receivedCommand)\n                        state.commandsHandler()\n                    }\n                    basic.pause(0)\n                }\n            })\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    export function addConnection(c: Connection): void {\n        initialise()\n        state.connections.push(c);\n    }\n\n\n    /**\n     * TODO: describe your function here\n     */\n    //% advanced\n    //% block\n    export function onDataReceived(command: string) {\n        initialise()\n        state.receivedCommands.push(command)\n        startProcessing()\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param data describe value here\n     */\n    //% block\n    export function sendString(data: string) {\n        initialise()\n        for (let index = 0; index < state.connections.length; index++) {\n            state.connections[index].sendString(data)\n        }\n    }\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function command() {\n        initialise()\n        return state.receivedCommand\n    }\n\n    /**\n     * TODO: describe your function here\n     * @param handler describe value here\n     */\n    //% block\n    export function onCommand(handler: () => void): void {\n        initialise()\n        state.commandsHandler = handler\n    }\n}\n","remoteSerial.ts":"/**\n * Remote blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace remote {\n    class ConnectionSerial implements Connection {\n        sendString(data: string) {\n            serial.writeLine(data)\n        }\n        constructor() {\n            remote.addConnection(this)\n            serial.setWriteLinePadding(0)\n            serial.setTxBufferSize(240)\n            serial.setRxBufferSize(240)\n            serial.onDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                this.active = true;\n                remote.onDataReceived(serial.readUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n        }\n    }\n    let _connectSerial: ConnectionSerial = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function useSerial(): void {\n        if (_connectSerial == undefined) {\n            _connectSerial = new ConnectionSerial\n        }\n    }\n}\n","remoteBluetooth.ts":"/**\n * Remote blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\"\nnamespace remote {\n    class ConnectBluetooth implements Connection {\n        sendString(data: string) {\n            bluetooth.uartWriteString(data)\n        }\n        constructor() {\n            remote.addConnection(this);\n            bluetooth.onUartDataReceived(serial.delimiters(Delimiters.NewLine), function () {\n                remote.onDataReceived(bluetooth.uartReadUntil(serial.delimiters(Delimiters.NewLine)))\n            })\n            bluetooth.startUartService()\n        }\n    }\n    let _connectBluetooth: ConnectBluetooth = undefined\n\n    /**\n     * TODO: describe your function here\n     */\n    //% block\n    export function useBluetooth(): void {\n        if (_connectBluetooth == undefined) {\n            _connectBluetooth = new ConnectBluetooth\n        }\n    }\n}\n","test.ts":"// Add your code here\n","pxt.json":"{\n    \"name\": \"remote-bluetooth\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"microphone\": \"*\",\n        \"bluetooth\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"remote.ts\",\n        \"remoteSerial.ts\",\n        \"remoteBluetooth.ts\",\n        \"test.ts\"\n    ],\n    \"preferredEditor\": \"blocksprj\"\n}\n"}}],"shares":[{"id":"48044-15689-24936-44182","timestamp":1766147697896}],"lastSaveTime":1766176264607}